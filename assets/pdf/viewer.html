<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html, body {
        margin: 0; padding: 0; height: 100%; background: #111;
      }
      #viewer {
        width: 100%;
        height: 100%;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        padding: 8px 0;
      }
      canvas {
        display: block;
        margin: 0 auto 12px;
        background: #fff;
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div id="viewer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      const params = new URLSearchParams(location.search);
      const file = params.get("file");
      const viewer = document.getElementById("viewer");

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      async function renderPDF(url) {
        const pdf = await pdfjsLib.getDocument(url).promise;

        // viewer 너비 구해서 페이지를 거기에 "맞춰서" 렌더링
        const containerWidth = viewer.clientWidth || window.innerWidth;

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);

          // 1.0 스케일 기준 viewport
          const baseViewport = page.getViewport({ scale: 1 });

          // 화면 너비에 딱 맞게 스케일 계산 (가로 fit)
          const scale = containerWidth / baseViewport.width;

          const viewport = page.getViewport({ scale });

          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");

          canvas.width = viewport.width;
          canvas.height = viewport.height;

          viewer.appendChild(canvas);

          await page.render({ canvasContext: ctx, viewport }).promise;
        }
      }

      renderPDF(file);
    </script>
  </body>
</html>
